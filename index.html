<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Pixel Rogue RPG</title>
<style>
body {
  background:#111;
  color:white;
  text-align:center;
  font-family:sans-serif;
}
canvas {
  border:2px solid #555;
  margin:auto;
  display:block;
  background:black;
  pointer-events:none;
}
button {
  font-size:18px;
  margin:5px;
}
#controlUI button {
  width:60px;
  height:60px;
  font-size:26px;
}
</style>
</head>
<body>

<h2 id="timeText">ğŸŒ ë‚®</h2>

<canvas id="game" width="900" height="600"></canvas>

<div id="battleUI" style="display:none;">
  <button onclick="playerAttack()">ê³µê²©</button>
</div>

<div id="chestUI" style="display:none;">
  <h3>ğŸ“¦ ìƒì</h3>
  <button onclick="rollChest()">ìƒì ì—´ê¸°</button>
  <p id="chestResult"></p>
  <button onclick="closeChest()">ë‹«ê¸°</button>
</div>

<div id="inventoryUI" style="display:none;">
  <h3>ğŸ’ ì¸ë²¤í† ë¦¬</h3>
  <div id="itemList"></div>
  <hr>
  <p id="itemDesc">ì•„ì´í…œì„ ì„ íƒí•˜ì„¸ìš”</p>
  <button id="useItemBtn" onclick="useItem()" style="display:none;">ì‚¬ìš©</button>
  <br>
  <button onclick="toggleInventory()">ë‹«ê¸°</button>
</div>

<div id="controlUI">
  <button onclick="toggleInventory()">ğŸ’</button><br>
  <button onclick="explore()">â¬†ï¸</button><br>
  <button onclick="explore()">â¬…ï¸</button>
  <button onclick="explore()">â¬‡ï¸</button>
  <button onclick="explore()">â¡ï¸</button>
</div>

<script>
const ctx = document.getElementById("game").getContext("2d");

/* ===== í”Œë ˆì´ì–´ ===== */
let player = {
  hp: 10,
  maxHp: 10,
  atk: 3
};

/* ===== ìƒíƒœ ===== */
let monster = null;
let inBattle = false;
let playerTurn = true;

let gold = 0;
let inventory = [];
let stickTurns = 0;

/* ===== ë‚® / ë°¤ ===== */
let isDay = true;
let turnCount = 0;

/* ===== í™”ë©´ ===== */
function draw() {
  ctx.clearRect(0,0,900,600);
  ctx.fillStyle="white";

  ctx.fillText(`HP: ${player.hp}/${player.maxHp}`,20,30);
  ctx.fillText(`ATK: ${player.atk}`,20,50);
  ctx.fillText(`Gold: ${gold}`,20,70);

  if (monster) {
    ctx.fillText(`ëª¬ìŠ¤í„° HP: ${monster.hp}`,650,30);
  }
}
draw();

/* ===== íƒìƒ‰ ===== */
function explore() {
  if (inBattle) return;

  const roll = Math.random();
  if (roll < 0.4) spawnMonster();
  else if (roll < 0.6) openChest();
  else alert("ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•Šì•˜ë‹¤");
}

/* ===== ëª¬ìŠ¤í„° ===== */
function spawnMonster() {
  monster = {
    hp: isDay ? 5 : 7,
    atk: isDay ? 2 : 3
  };
  inBattle = true;
  playerTurn = true;
  document.getElementById("battleUI").style.display="block";
  draw();
}

/* ===== ì „íˆ¬ ===== */
function playerAttack() {
  if (!playerTurn || !inBattle) return;

  monster.hp -= player.atk;
  playerTurn = false;
  draw();

  if (monster.hp <= 0) {
    endBattle();
    return;
  }
  setTimeout(monsterAttack,500);
}

function monsterAttack() {
  player.hp -= monster.atk;
  playerTurn = true;
  draw();

  if (player.hp <= 0) {
    alert("ê²Œì„ ì˜¤ë²„");
    location.reload();
  }
}

function endBattle() {
  inBattle = false;
  monster = null;
  document.getElementById("battleUI").style.display="none";

  turnCount++;
  if (turnCount % 5 === 0) {
    isDay = !isDay;
    document.getElementById("timeText").innerText = isDay ? "ğŸŒ ë‚®" : "ğŸŒ™ ë°¤";
  }

  if (stickTurns > 0) {
    stickTurns--;
    if (stickTurns === 0) {
      player.atk--;
      inventory = inventory.filter(i => i.name !== "ë‚˜ë­‡ê°€ì§€");
    }
  }
  draw();
}

/* ===== ìƒì ===== */
function openChest() {
  document.getElementById("chestUI").style.display="block";
}

function rollChest() {
  const roll = Math.floor(Math.random()*6)+1;
  let text = `ì£¼ì‚¬ìœ„ ${roll}: `;

  if (roll <= 2) {
    player.atk++;
    stickTurns = 3;
    inventory.push({
      name:"ë‚˜ë­‡ê°€ì§€",
      type:"weapon",
      desc:"ê³µê²© +1 (3ì „íˆ¬ í›„ íŒŒê´´)"
    });
    text += "ë‚˜ë­‡ê°€ì§€ íšë“!";
  }
  else if (roll <= 4) {
    gold++;
    text += "ê³¨ë“œ +1";
  }
  else {
    text += "ë¯¸ë¯¹ ë“±ì¥!";
    document.getElementById("chestResult").innerText=text;
    spawnMimic();
    return;
  }

  document.getElementById("chestResult").innerText=text;
  draw();
}

function spawnMimic() {
  monster = { hp:1, atk:1 };
  inBattle = true;
  playerTurn = false;
  closeChest();
  draw();
  setTimeout(monsterAttack,500);
}

function closeChest() {
  document.getElementById("chestUI").style.display="none";
}

/* ===== ì¸ë²¤í† ë¦¬ ===== */
let selectedItemIndex = null;

function toggleInventory() {
  const ui = document.getElementById("inventoryUI");
  ui.style.display = ui.style.display === "none" ? "block" : "none";
  renderInventory();
}

function renderInventory() {
  const list = document.getElementById("itemList");
  list.innerHTML = "";

  inventory.forEach((item, idx) => {
    const btn = document.createElement("button");
    btn.innerText = item.name;
    btn.onclick = () => selectItem(idx);
    list.appendChild(btn);
  });

  if (inventory.length === 0) list.innerText = "ë¹„ì–´ ìˆìŒ";
  document.getElementById("itemDesc").innerText = "ì•„ì´í…œì„ ì„ íƒí•˜ì„¸ìš”";
  document.getElementById("useItemBtn").style.display="none";
}

function selectItem(idx) {
  selectedItemIndex = idx;
  const item = inventory[idx];
  document.getElementById("itemDesc").innerText = item.desc;
  document.getElementById("useItemBtn").style.display =
    item.type === "consumable" ? "inline-block" : "none";
}

function useItem() {
  if (selectedItemIndex === null) return;
  const item = inventory[selectedItemIndex];

  if (item.type === "consumable") {
    player.hp = Math.min(player.maxHp, player.hp + 3);
    inventory.splice(selectedItemIndex,1);
    selectedItemIndex = null;
    renderInventory();
    draw();
  }
}
</script>
</body>
</html>
