<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Pixel Rogue RPG</title>
<style>
body {
  background:#111;
  color:white;
  text-align:center;
  font-family:sans-serif;
}
canvas {
  border:2px solid #555;
  margin:auto;
  display:block;
  background:black;
  pointer-events:none;
}
button {
  font-size:18px;
  margin:5px;
}
#controlUI button {
  width:60px;
  height:60px;
  font-size:26px;
}
</style>
</head>
<body>

<h2 id="timeText">ğŸŒ ë‚®</h2>

<canvas id="game" width="900" height="600"></canvas>

<div id="battleUI" style="display:none;">
  <button onclick="playerAttack()">ê³µê²©</button>
</div>

<div id="chestUI" style="display:none;">
  <h3>ğŸ“¦ ìƒì</h3>
  <button onclick="rollChest()">ìƒì ì—´ê¸°</button>
  <p id="chestResult"></p>
  <button onclick="closeChest()">ë‹«ê¸°</button>
</div>

<div id="controlUI">
  <button onclick="explore()">â¬†ï¸</button><br>
  <button onclick="explore()">â¬…ï¸</button>
  <button onclick="explore()">â¬‡ï¸</button>
  <button onclick="explore()">â¡ï¸</button>
</div>

<script>
/* ===== ê¸°ë³¸ ===== */
const ctx = document.getElementById("game").getContext("2d");

let player = {
  hp:10,
  maxHp:10,
  atk:3
};

let monster = null;
let inBattle = false;
let playerTurn = true;

let gold = 0;
let inventory = [];
let stickTurns = 0;

/* ===== ë‚® / ë°¤ ===== */
let isDay = true;
let turnCount = 0;

/* ===== í™”ë©´ ===== */
function draw() {
  ctx.clearRect(0,0,900,600);

  ctx.fillStyle="white";
  ctx.fillText(`HP: ${player.hp}/${player.maxHp}`,20,30);
  ctx.fillText(`ATK: ${player.atk}`,20,50);
  ctx.fillText(`Gold: ${gold}`,20,70);
  ctx.fillText(`Inventory: ${inventory.join(", ")}`,20,90);

  if (monster) {
    ctx.fillText(`ëª¬ìŠ¤í„° HP: ${monster.hp}`,650,30);
  }
}
draw();

/* ===== íƒìƒ‰ ===== */
function explore() {
  if (inBattle) return;

  const roll = Math.random();

  if (roll < 0.4) {
    spawnMonster();
  }
  else if (roll < 0.6) {
    openChest();
  }
  else {
    alert("ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•Šì•˜ë‹¤");
  }
}

/* ===== ëª¬ìŠ¤í„° ===== */
function spawnMonster() {
  monster = {
    hp: isDay ? 5 : 7,
    atk: isDay ? 2 : 3
  };
  inBattle = true;
  playerTurn = true;
  document.getElementById("battleUI").style.display="block";
  draw();
}

/* ===== ì „íˆ¬ ===== */
function playerAttack() {
  if (!playerTurn || !inBattle) return;

  monster.hp -= player.atk;
  playerTurn = false;
  draw();

  if (monster.hp <= 0) {
    endBattle();
    return;
  }
  setTimeout(monsterAttack,500);
}

function monsterAttack() {
  player.hp -= monster.atk;
  playerTurn = true;
  draw();

  if (player.hp <= 0) {
    alert("ê²Œì„ ì˜¤ë²„");
    location.reload();
  }
}

function endBattle() {
  inBattle = false;
  monster = null;
  document.getElementById("battleUI").style.display="none";

  // í„´ ì¦ê°€
  turnCount++;
  if (turnCount % 5 === 0) {
    isDay = !isDay;
    document.getElementById("timeText").innerText =
      isDay ? "ğŸŒ ë‚®" : "ğŸŒ™ ë°¤";
  }

  // ë‚˜ë­‡ê°€ì§€ ê°ì†Œ
  if (stickTurns > 0) {
    stickTurns--;
    if (stickTurns === 0) {
      player.atk--;
      inventory = inventory.filter(i => i !== "ë‚˜ë­‡ê°€ì§€");
    }
  }

  draw();
}

/* ===== ìƒì ===== */
function openChest() {
  document.getElementById("chestUI").style.display="block";
}

function rollChest() {
  const roll = Math.floor(Math.random()*6)+1;
  let text = `ì£¼ì‚¬ìœ„ ${roll}: `;

  if (roll <= 2) {
    player.atk++;
    stickTurns = 3;
    inventory.push("ë‚˜ë­‡ê°€ì§€");
    text += "ë‚˜ë­‡ê°€ì§€ íšë“ (ê³µê²© +1)";
  }
  else if (roll <= 4) {
    gold++;
    text += "ê³¨ë“œ +1";
  }
  else {
    text += "ë¯¸ë¯¹ ë“±ì¥!";
    document.getElementById("chestResult").innerText=text;
    spawnMimic();
    return;
  }

  document.getElementById("chestResult").innerText=text;
  draw();
}

function spawnMimic() {
  monster = {
    hp:1,
    atk:1
  };
  inBattle = true;
  playerTurn = false;
  closeChest();
  draw();
  setTimeout(monsterAttack,500);
}

function closeChest() {
  document.getElementById("chestUI").style.display="none";
}
</script>
</body>
</html>
