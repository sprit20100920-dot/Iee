<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Rogue RPG</title>
<style>
body{text-align:center;font-family:sans-serif;}
.day{background:#f2f2f2;color:black;}
.night{background:#111;color:white;}
#box{width:900px;margin:auto;border:2px solid #555;padding:10px;}
.panel{border:1px solid #444;margin:6px;padding:6px;}
button{margin:4px;font-size:15px;}
.hidden{display:none;}
.red{color:red;font-weight:bold;}
</style>
</head>
<body class="day">

<!-- ì‹œì‘ -->
<div id="startUI">
<h2>ìŠ¤íƒ¯ ë¶„ë°° (ì´ 10)</h2>
SPD <span id="spd">0</span>
<button onclick="stat('spd',1)">+</button>
<button onclick="stat('spd',-1)">-</button><br>
HP <span id="hp">0</span> (ìµœëŒ€ 9)
<button onclick="stat('hp',1)">+</button>
<button onclick="stat('hp',-1)">-</button><br>
ATK <span id="atk">0</span>
<button onclick="stat('atk',1)">+</button>
<button onclick="stat('atk',-1)">-</button><br>
ë‚¨ì€ í¬ì¸íŠ¸ <span id="pt">10</span><br>
<button onclick="startGame()">ì‹œì‘</button>
</div>

<!-- ê²Œì„ -->
<div id="box" class="hidden">
<h3><span id="timeUI">ğŸŒ DAY</span> | ìƒì¡´ <span id="days">1</span>ì¼</h3>

<div class="panel">
<b>PLAYER</b><br>
HP <span id="pHp"></span>
ATK <span id="pAtk"></span>
SPD <span id="pSpd"></span>
</div>

<div class="panel">
<b>MONSTER</b><br>
<span id="mInfo">ì—†ìŒ</span>
</div>

<div class="panel">
Gold <span id="gold">0</span><br>
Items: <span id="itemsUI">ì—†ìŒ</span>
</div>

<div id="log">ì´ë™í•˜ì</div>
<button onclick="move()">ì´ë™</button>

<div id="choiceUI" class="hidden">
<button onclick="openBox()">ì—´ê¸°</button>
<button onclick="cancelBox()">ë„ë§</button>
</div>

<div id="battleUI" class="hidden">
<button onclick="attack()">ê³µê²©</button>
<button onclick="escape()">ë„ë§</button>
</div>

<button style="margin-top:40px" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ</button>
</div>

<!-- ì‚¬ë§ -->
<div id="deadUI" class="hidden">
<h1>â˜ ï¸ ì‚¬ë§</h1>
<div id="deadInfo"></div>
<button onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘</button>
</div>

<script>
let stats={spd:0,hp:0,atk:0}, pt=10;
let player, monster=null;
let isDay=true, dayCount=1, turn=0;
let gold=0;
let items={ branch:{count:0,turns:[]} };
let stunned=false;
let killedBy="";
let boxType=null;

function stat(k,v){
 if(k==="hp" && stats.hp+v>9) return;
 if(pt-v<0||stats[k]+v<0) return;
 stats[k]+=v; pt-=v;
 spd.innerText=stats.spd;
 hp.innerText=stats.hp;
 atk.innerText=stats.atk;
 pt.innerText=pt;
}

function startGame(){
 if(stats.hp<=0||pt>0) return alert("ìŠ¤íƒ¯ í™•ì¸!");
 player={...stats,hp:stats.hp};
 startUI.classList.add("hidden");
 box.classList.remove("hidden");
 update();
}

function move(){
 let r=Math.random();
 let monsterRate=isDay?0.33:0.66;
 if(r<monsterRate){ spawnMonster(); return; }
 if(r<monsterRate+0.10){ findBox("advanced"); return; }
 findBox("normal");
}

function findBox(type){
 boxType=type;
 choiceUI.classList.remove("hidden");
 log(type==="advanced"
  ? '<span class="red">ğŸ”´ ê³ ê¸‰ ìƒìë¥¼ ë°œê²¬í–ˆë‹¤!</span>'
  : "ğŸ“¦ ìƒìë¥¼ ë°œê²¬í–ˆë‹¤!");
}

function openBox(){
 choiceUI.classList.add("hidden");

 if(boxType==="normal"){
  let d=Math.floor(Math.random()*6)+1;
  if(d<=2){
    if(items.branch.count>=3){
      log("ğŸŒ¿ ë‚˜ë­‡ê°€ì§€ê°€ ë„ˆë¬´ ë§ë‹¤!");
    }else{
      items.branch.count++;
      items.branch.turns.push(3);
      player.atk++;
      log("ğŸŒ¿ ë‚˜ë­‡ê°€ì§€ íšë“! (ê³µê²© +1)");
    }
  }
  else if(d<=4){
    gold++;
    log("ğŸ’° ê³¨ë“œ 1 íšë“");
  }
  else{
    log("ğŸ˜ˆ ë¯¸ë¯¹ì´ë‹¤!");
    spawnMimic();
  }
 }

 if(boxType==="advanced"){
  if(gold<3){
    log("ì—´ ìˆ˜ ì—†ë‹¤ (ê³¨ë“œ 3 í•„ìš”)");
    boxType=null;
    return;
  }
  gold-=3;
  player.atk++;
  log("âœ¨ ì² ê²€ íšë“! (ê³µê²© +1)");
 }

 boxType=null;
 update();
}

function cancelBox(){
 choiceUI.classList.add("hidden");
 log("ì¡°ì‹¬íˆ ë¬¼ëŸ¬ë‚¬ë‹¤");
 boxType=null;
}

function spawnMonster(){
 let r=Math.random();
 if(r<0.33) monster={name:"í¬ì´ì¦Œ í”Œë¼ì›Œ",hp:6,atk:0,spd:0,type:1};
 else if(r<0.66) monster={name:"ë°•ì¥",hp:3,atk:1,spd:3,type:2};
 else monster={name:"ì—¬ìš°",hp:3,atk:3,spd:3,type:3};
 battleUI.classList.remove("hidden");
 log(monster.name+" ë“±ì¥!");
 firstStrike();
 update();
}

function spawnMimic(){
 monster={name:"ë¯¸ë¯¹",hp:5,atk:2,spd:2,type:4};
 battleUI.classList.remove("hidden");
 firstStrike();
 update();
}

function firstStrike(){
 if(monster.spd>player.spd) monsterAttack();
 else if(monster.spd===player.spd && monster.hp<player.hp) monsterAttack();
}

function attack(){
 if(stunned){stunned=false;log("ê°ì „! ê³µê²© ë¶ˆê°€"); monsterAttack(); return;}
 monster.hp-=player.atk;
 if(monster.hp<=0){ win(); return; }
 monsterAttack();
}

function monsterAttack(){
 if(monster.type===2 && Math.random()>0.5) stunned=true;
 player.hp-=monster.atk;
 if(player.hp<=0) die();
 update();
}

function win(){
 log(monster.name+" ì²˜ì¹˜!");
 monster=null;
 battleUI.classList.add("hidden");
 processItemTurns();
 turn++;
 if(turn>=5){
  turn=0;
  if(isDay)isDay=false;
  else{isDay=true;dayCount++;}
 }
 update();
}

function processItemTurns(){
 for(let i=items.branch.turns.length-1;i>=0;i--){
  items.branch.turns[i]--;
  if(items.branch.turns[i]<=0){
    items.branch.turns.splice(i,1);
    items.branch.count--;
    player.atk--;
    log("ğŸŒ¿ ë‚˜ë­‡ê°€ì§€ê°€ ë¶€ì„œì¡Œë‹¤!");
  }
 }
}

function escape(){
 let d=Math.floor(Math.random()*6)+1;
 if(d<=4) monsterAttack();
 else win();
}

function die(){
 killedBy=monster.name;
 box.classList.add("hidden");
 deadUI.classList.remove("hidden");
 deadInfo.innerHTML=`${dayCount}ì¼ì§¸<br>${killedBy}ì—ê²Œ ì“°ëŸ¬ì¡Œë‹¤`;
}

function update(){
 document.body.className=isDay?"day":"night";
 timeUI.innerText=isDay?"ğŸŒ DAY":"ğŸŒ™ NIGHT";
 days.innerText=dayCount;
 pHp.innerText=player.hp;
 pAtk.innerText=player.atk;
 pSpd.innerText=player.spd;
 mInfo.innerText=monster?`${monster.name} HP:${monster.hp} ATK:${monster.atk} SPD:${monster.spd}`:"ì—†ìŒ";
 gold.innerText=gold;
 itemsUI.innerText=items.branch.count>0?`ë‚˜ë­‡ê°€ì§€:${items.branch.count}`:"ì—†ìŒ";
}
function log(t){document.getElementById("log").innerHTML=t;}
</script>
</body>
</html>
