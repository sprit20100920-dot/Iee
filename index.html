<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Pixel Rogue RPG</title>
<style>
body{text-align:center;font-family:sans-serif;}
.day{background:#f5f5f5;color:#000;}
.night{background:#111;color:#fff;}
#game{width:900px;margin:auto;border:2px solid #444;padding:10px;}
.panel{border:1px solid #666;margin:6px;padding:6px;}
button{margin:4px;font-size:15px;}
.hidden{display:none;}
.select{border:2px solid red;}
.red{color:red;font-weight:bold;}
</style>
</head>

<body class="day">

<!-- ì‹œì‘ -->
<div id="startUI">
<h2>ìŠ¤íƒ¯ ë¶„ë°° (ì´ 10)</h2>
SPD <span id="spdVal">0</span>
<button onclick="addStat('spd',1)">+</button>
<button onclick="addStat('spd',-1)">-</button><br>
HP <span id="hpVal">0</span>
<button onclick="addStat('hp',1)">+</button>
<button onclick="addStat('hp',-1)">-</button><br>
ATK <span id="atkVal">0</span>
<button onclick="addStat('atk',1)">+</button>
<button onclick="addStat('atk',-1)">-</button><br>
ë‚¨ì€ í¬ì¸íŠ¸ <span id="ptVal">10</span><br><br>
<button onclick="startGame()">ê²Œì„ ì‹œì‘</button>
</div>

<!-- ê²Œì„ -->
<div id="game" class="hidden">
<h3>
<span id="timeUI">ğŸŒ DAY</span> |
ìƒì¡´ <span id="dayCnt">1</span>ì¼
</h3>

<div class="panel">
<b>PLAYER</b><br>
HP <span id="pHp"></span>
ATK <span id="pAtk"></span>
SPD <span id="pSpd"></span>
</div>

<div class="panel">
<b>MONSTER</b><br>
<span id="mInfo">ì—†ìŒ</span>
</div>

<div class="panel">
<b>INVENTORY</b><br>
Gold: <span id="goldUI">0</span><br>
<div id="invUI"></div>
<button onclick="openInventory()">ì¸ë²¤í† ë¦¬</button>
</div>

<div id="log">ì´ë™í•˜ì</div>
<button onclick="move()">ì´ë™</button>

<!-- ì „íˆ¬ -->
<div id="battleUI" class="hidden">
<button onclick="attack()">ê³µê²©</button>
<button onclick="escape()">ë„ë§</button>
</div>

<!-- ìƒì -->
<div id="boxUI" class="hidden">
<button onclick="openBox()">ì—´ê¸°</button>
<button onclick="closeBox()">ë„ë§</button>
</div>

<!-- ì¸ë²¤í† ë¦¬ UI -->
<div id="inventoryUI" class="hidden">
<h3>ì¸ë²¤í† ë¦¬</h3>
<div id="invSelect"></div>
<button onclick="useItem()">ì‚¬ìš©</button>
<button onclick="closeInventory()">ë‹«ê¸°</button><br>
<button onclick="invMove(-1)">â—€</button>
<button onclick="invMove(1)">â–¶</button>
</div>

<!-- ê³ ê¸‰ ìƒì -->
<div id="advancedUI" class="hidden">
<h3 class="red">ğŸ”´ ê³ ê¸‰ ìƒì</h3>
<div id="advItems"></div>
<button onclick="pickAdv()">ì„ íƒ</button>
</div>

<button style="margin-top:30px" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ</button>
</div>

<!-- ì‚¬ë§ -->
<div id="deadUI" class="hidden">
<h1>â˜ ï¸ ì‚¬ë§</h1>
<div id="deadInfo"></div>
<button onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘</button>
</div>

<script>
/* ===== ìŠ¤íƒ¯ ===== */
let stats={spd:0,hp:0,atk:0}, pt=10;
const spdVal=spdVal=document.getElementById("spdVal");
const hpVal=document.getElementById("hpVal");
const atkVal=document.getElementById("atkVal");
const ptVal=document.getElementById("ptVal");

function addStat(k,v){
 if(v>0 && pt<=0) return;
 if(v<0 && stats[k]<=0) return;
 stats[k]+=v; pt-=v;
 spdVal.innerText=stats.spd;
 hpVal.innerText=stats.hp;
 atkVal.innerText=stats.atk;
 ptVal.innerText=pt;
}

let player, monster=null;
let gold=0, day=1, isDay=true, turn=0;
let items={branch:{count:0,turns:[]}, potion:0, ruby:0};
let invList=[], invIndex=0;
let boxType=null, stunned=false;

/* ===== ì‹œì‘ ===== */
function startGame(){
 if(stats.hp<=0) return alert("ì²´ë ¥ì€ ìµœì†Œ 1");
 player={...stats,hp:stats.hp};
 startUI.classList.add("hidden");
 game.classList.remove("hidden");
 update();
}

/* ===== ì´ë™ ===== */
function move(){
 let r=Math.random();
 let mRate=isDay?4/12:8/12;
 if(r<mRate){ spawnMonster(); return; }
 if(r<mRate+0.15){ findBox("advanced"); return; }
 findBox("normal");
}

/* ===== ìƒì ===== */
function findBox(type){
 boxType=type;
 boxUI.classList.remove("hidden");
 log(type==="advanced"
  ? "<span class='red'>ê³ ê¸‰ ìƒìë¥¼ ë°œê²¬í–ˆë‹¤!</span>"
  : "ìƒìë¥¼ ë°œê²¬í–ˆë‹¤!");
}

function openBox(){
 boxUI.classList.add("hidden");
 if(boxType==="normal"){
  let d=Math.floor(Math.random()*6)+1;
  if(d<=2 && items.branch.count<3){
    items.branch.count++;
    log("ğŸŒ¿ ë‚˜ë­‡ê°€ì§€ íšë“");
  }else if(d<=4){
    gold++;
    log("ğŸ’° ê³¨ë“œ íšë“");
  }else{
    spawnMimic(); boxType=null; update(); return;
  }
 }
 if(boxType==="advanced"){
  advancedUI.classList.remove("hidden");
  return;
 }
 boxType=null; update();
}

function closeBox(){ boxUI.classList.add("hidden"); boxType=null; }

/* ===== ê³ ê¸‰ ìƒì ===== */
const advPool=[
 "í¬ì…˜(+2HP)",
 "ì² ê²€(+1ATK)",
 "ë‚¡ì€ë°©íŒ¨(+2HP)",
 "ì² ê°‘ì˜·(+1HP)",
 "ê°’ì‹¼ê·€ê±¸ì´(íšŒí”¼)"
];
let advIndex=0;

function pickAdv(){
 advancedUI.classList.add("hidden");
 let pick=advPool[advIndex];
 if(pick.includes("í¬ì…˜")) items.potion++;
 if(pick.includes("ì² ê²€")) player.atk++;
 if(pick.includes("ë°©íŒ¨")){player.hp+=2;}
 if(pick.includes("ê°‘ì˜·")){player.hp+=1;}
 log(pick+" íšë“!");
 update();
}

/* ===== ì¸ë²¤í† ë¦¬ ===== */
function openInventory(){
 inventoryUI.classList.remove("hidden");
 invList=[];
 if(items.branch.count>0) invList.push("ë‚˜ë­‡ê°€ì§€");
 if(items.potion>0) invList.push("í¬ì…˜");
 invIndex=0;
 renderInv();
}

function invMove(d){
 if(invList.length===0) return;
 invIndex=(invIndex+d+invList.length)%invList.length;
 renderInv();
}

function renderInv(){
 invSelect.innerHTML="";
 invList.forEach((it,i)=>{
  let s=document.createElement("div");
  s.innerText=it;
  if(i===invIndex) s.className="select";
  invSelect.appendChild(s);
 });
}

function useItem(){
 let it=invList[invIndex];
 if(it==="í¬ì…˜" && items.potion>0){
  items.potion--; player.hp+=2;
  log("í¬ì…˜ ì‚¬ìš© (+2HP)");
 }
 if(it==="ë‚˜ë­‡ê°€ì§€" && items.branch.count>0){
  items.branch.count--;
  items.branch.turns.push(3);
  player.atk++;
  log("ë‚˜ë­‡ê°€ì§€ ì‚¬ìš© (+1ATK)");
 }
 closeInventory(); update();
}

function closeInventory(){ inventoryUI.classList.add("hidden"); }

/* ===== ëª¬ìŠ¤í„° ===== */
function spawnMonster(){
 monster={name:"ë°•ì¥",hp:3,atk:1,spd:3};
 battleUI.classList.remove("hidden");
 log("ë°•ì¥ ë“±ì¥!");
 firstStrike(); update();
}

function spawnMimic(){
 monster={name:"ë¯¸ë¯¹",hp:5,atk:2,spd:99};
 battleUI.classList.remove("hidden");
 log("ë¯¸ë¯¹ì´ë‹¤!");
 firstStrike(); update();
}

function firstStrike(){
 if(monster.spd>player.spd) monsterAttack();
}

/* ===== ì „íˆ¬ ===== */
function attack(){
 monster.hp-=player.atk;
 if(monster.hp<=0){ win(); return; }
 monsterAttack();
}
function monsterAttack(){
 player.hp-=monster.atk;
 if(player.hp<=0) die();
 update();
}
function win(){
 log(monster.name+" ì²˜ì¹˜!");
 monster=null;
 battleUI.classList.add("hidden");
 turn++;
 if(turn>=5){
  turn=0;
  isDay=!isDay;
  if(isDay) day++;
 }
 update();
}
function escape(){ monsterAttack(); }

/* ===== íŒ¨ë°° ===== */
function die(){
 game.classList.add("hidden");
 deadUI.classList.remove("hidden");
 deadInfo.innerHTML=`${day}ì¼ì§¸<br>${monster.name}ì—ê²Œ ì‚¬ë§`;
}

/* ===== UI ===== */
function update(){
 document.body.className=isDay?"day":"night";
 timeUI.innerText=isDay?"ğŸŒ DAY":"ğŸŒ™ NIGHT";
 dayCnt.innerText=day;
 pHp.innerText=player.hp;
 pAtk.innerText=player.atk;
 pSpd.innerText=player.spd;
 mInfo.innerText=monster?`${monster.name} HP:${monster.hp}`:"ì—†ìŒ";
 goldUI.innerText=gold;
 let inv=[];
 if(items.branch.count>0) inv.push(`ë‚˜ë­‡ê°€ì§€:${items.branch.count}`);
 if(items.potion>0) inv.push(`í¬ì…˜:${items.potion}`);
 invUI.innerText=inv.length?inv.join(", "):"ì—†ìŒ";
}
function log(t){document.getElementById("log").innerHTML=t;}
</script>
</body>
</html>
